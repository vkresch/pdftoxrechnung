<?xml version="1.0" encoding="UTF-8"?>
<ubl:Invoice xmlns:ubl="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2" xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
    <cbc:CustomizationID>urn:cen.eu:en16931:2017#compliant#urn:xeinkauf.de:kosit:xrechnung_3.0</cbc:CustomizationID>
    <cbc:ProfileID>urn:fdc:peppol.eu:2017:poacc:billing:01:1.0</cbc:ProfileID>
    <cbc:ID>{{ data.invoiceNumber }}</cbc:ID>
    <cbc:IssueDate>{{ data.invoiceDate }}</cbc:IssueDate>
    {% if data.dueDate != "" -%}
    <cbc:DueDate>{{ data.dueDate }}</cbc:DueDate>
    {% endif -%}
    <cbc:InvoiceTypeCode>380</cbc:InvoiceTypeCode>
    <cbc:Note>{{ data.note }}</cbc:Note>
    <cbc:DocumentCurrencyCode>EUR</cbc:DocumentCurrencyCode>
    <cbc:BuyerReference>{{ data.customerOrderNumber }}</cbc:BuyerReference>
    <cac:AccountingSupplierParty>
        <cac:Party>
            <cbc:EndpointID schemeID="EM">{{ data.ownCompanyID }}</cbc:EndpointID>
            <cac:PartyName>
                <cbc:Name>{{ data.ownCompanyName }}</cbc:Name>
            </cac:PartyName>
            <cac:PostalAddress>
                <cbc:StreetName>{{ data.ownStreetname }}</cbc:StreetName>
                <cbc:CityName>{{ data.ownCityname }}</cbc:CityName>
                <cbc:PostalZone>{{ data.ownPostalCode }}</cbc:PostalZone>
                <cac:Country>
                    <cbc:IdentificationCode>DE</cbc:IdentificationCode>
                </cac:Country>
            </cac:PostalAddress>
            <cac:PartyTaxScheme>
                <cbc:CompanyID>{{ data.ownCompanyID }}</cbc:CompanyID>
                <cac:TaxScheme>
                    <cbc:ID>VAT</cbc:ID>
                </cac:TaxScheme>
            </cac:PartyTaxScheme>
            <cac:PartyLegalEntity>
                <cbc:RegistrationName>{{ data.ownCompanyName }}</cbc:RegistrationName>
                <cbc:CompanyID>{{ data.ownHraNo }}</cbc:CompanyID>
                <cbc:CompanyLegalForm>{{ data.ownLegalForm }}</cbc:CompanyLegalForm>
            </cac:PartyLegalEntity>
            <cac:Contact>
                <cbc:Name>{{ data.ownContactName }}</cbc:Name>
                <cbc:Telephone>{{ data.ownContactPhone }}</cbc:Telephone>
                <cbc:ElectronicMail>{{ data.ownContactEmail }}</cbc:ElectronicMail>
            </cac:Contact>
        </cac:Party>
    </cac:AccountingSupplierParty>
    <cac:AccountingCustomerParty>
        <cac:Party>
            <cbc:EndpointID schemeID="EM">{{ data.customerID }}</cbc:EndpointID>
            {% if data.customerCompanyID is not none and data.customerCompanyID != "" %}
            <cac:PartyIdentification>
                <cbc:ID>{{ data.customerCompanyID }}</cbc:ID>
            </cac:PartyIdentification>
            {% endif -%}
            <cac:PostalAddress>
                <cbc:StreetName>{{ data.customerStreetname }}</cbc:StreetName>
                <cbc:CityName>{{ data.customerCityname }}</cbc:CityName>
                <cbc:PostalZone>{{ data.customerPostalZone }}</cbc:PostalZone>
                <cac:Country>
                    <cbc:IdentificationCode>DE</cbc:IdentificationCode>
                </cac:Country>
            </cac:PostalAddress>
            <cac:PartyLegalEntity>
                <cbc:RegistrationName>{{ data.customerCompanyName }}</cbc:RegistrationName>
            </cac:PartyLegalEntity>
            <cac:Contact>
                <cbc:Name>{{ data.customerContactName }}</cbc:Name>
            </cac:Contact>
        </cac:Party>
    </cac:AccountingCustomerParty>
    <cac:PaymentMeans>
        <cbc:PaymentMeansCode>{{ data.paymentMeansCode }}</cbc:PaymentMeansCode>
        <cbc:PaymentID>{{ data.invoiceNumber }}</cbc:PaymentID>
        <cac:PayeeFinancialAccount>
            <cbc:ID>{{ data.ownIban }}</cbc:ID>
        </cac:PayeeFinancialAccount>
    </cac:PaymentMeans>
    <cac:PaymentTerms>
        <cbc:Note>Zahlung innerhalb von {{ data.dueDays }} Tagen ab Rechnungseingang ohne Abz√ºge</cbc:Note>
    </cac:PaymentTerms>
    <cac:TaxTotal>
        <cbc:TaxAmount currencyID="EUR">{{ data.priceTax }}</cbc:TaxAmount>
        <cac:TaxSubtotal>
            <cbc:TaxableAmount currencyID="EUR">{{ data.priceNet }}</cbc:TaxableAmount>
            <cbc:TaxAmount currencyID="EUR">{{ data.priceTax }}</cbc:TaxAmount>
            {% if data.taxPercent is not none -%}
            <cac:TaxCategory>
                <cbc:ID>S</cbc:ID>
                <cbc:Percent>{{ data.taxPercent }}</cbc:Percent>
                <cac:TaxScheme>
                    <cbc:ID>VAT</cbc:ID>
                </cac:TaxScheme>
            </cac:TaxCategory>
            {% endif -%}
        </cac:TaxSubtotal>
    </cac:TaxTotal>
    <cac:LegalMonetaryTotal>
        <cbc:LineExtensionAmount currencyID="EUR">{{ data.priceNet }}</cbc:LineExtensionAmount>
        <cbc:TaxExclusiveAmount currencyID="EUR">{{ data.priceNet }}</cbc:TaxExclusiveAmount>
        <cbc:TaxInclusiveAmount currencyID="EUR">{{ data.priceFull }}</cbc:TaxInclusiveAmount>
        <cbc:PayableAmount currencyID="EUR">{{ data.priceFull }}</cbc:PayableAmount>
    </cac:LegalMonetaryTotal>
    {% for item in data.items -%}
    <cac:InvoiceLine>
        <cbc:ID>{{ item.lineID }}</cbc:ID>
        <cbc:InvoicedQuantity unitCode="XPP">{{ item.quantity }}</cbc:InvoicedQuantity>
        <cbc:LineExtensionAmount currencyID="EUR">{{ item.deliveryDetails }}</cbc:LineExtensionAmount>
        {% if item.periodStart != "" and item.periodEnd != "" -%}
        <cac:InvoicePeriod>
            <cbc:StartDate>{{ item.periodStart }}</cbc:StartDate>
            <cbc:EndDate>{{ item.periodEnd }}</cbc:EndDate>
        </cac:InvoicePeriod>
        {% endif -%}
        <cac:Item>
            <cbc:Description>{{ item.positionName }}</cbc:Description>
            <cbc:Name>{{ item.positionName }}</cbc:Name>
            <cac:SellersItemIdentification>
                <cbc:ID>{{ item.lineID }}</cbc:ID>
            </cac:SellersItemIdentification>
            <cac:ClassifiedTaxCategory>
                <cbc:ID>{{ item.taxCategory }}</cbc:ID>
                <cbc:Percent>{{ item.taxPercent }}</cbc:Percent>
                <cac:TaxScheme>
                    <cbc:ID>VAT</cbc:ID>
                </cac:TaxScheme>
            </cac:ClassifiedTaxCategory>
        </cac:Item>
        <cac:Price>
            <cbc:PriceAmount currencyID="EUR">{{ item.priceNet }}</cbc:PriceAmount>
        </cac:Price>
    </cac:InvoiceLine>
    {% endfor -%}
</ubl:Invoice>
